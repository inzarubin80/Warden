<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="900" viewBox="0 0 1200 900">
  <style>
    .tbl { fill:#ffffff; stroke:#2b6b2b; stroke-width:2 }
    .tbl-title { font: bold 16px Arial; fill:#2b6b2b }
    .field { font: 14px Arial; fill:#222 }
    .fk { font-style: italic; fill:#444 }
    .note { font: 12px Arial; fill:#444 }
    .line { stroke:#666; stroke-width:1.5 }
  </style>

  <!-- Users -->
  <rect x="30" y="30" width="300" height="140" rx="6" class="tbl" />
  <text x="40" y="55" class="tbl-title">users</text>
  <text x="40" y="80" class="field">id (UUID) PK</text>
  <text x="40" y="100" class="field">provider (vk|yandex)</text>
  <text x="40" y="120" class="field">provider_id (string)</text>
  <text x="40" y="140" class="field">name, email, avatar_url</text>
  <text x="40" y="160" class="field">created_at</text>

  <!-- Devices -->
  <rect x="370" y="30" width="300" height="100" rx="6" class="tbl" />
  <text x="380" y="55" class="tbl-title">devices</text>
  <text x="380" y="80" class="field">id (UUID) PK</text>
  <text x="380" y="100" class="field">user_id (UUID) FK → users.id</text>
  <text x="380" y="120" class="field">device_token, platform, created_at</text>

  <!-- Violations -->
  <rect x="30" y="210" width="420" height="220" rx="6" class="tbl" />
  <text x="40" y="235" class="tbl-title">violations</text>
  <text x="40" y="260" class="field">id (UUID) PK</text>
  <text x="40" y="280" class="field">user_id (UUID) FK → users.id</text>
  <text x="40" y="300" class="field">type (enum)</text>
  <text x="40" y="320" class="field">description (text)</text>
  <text x="40" y="340" class="field">lat, lng (decimal)</text>
  <text x="40" y="360" class="field">status (new|confirmed|resolved)</text>
  <text x="40" y="380" class="field">confirmations_count, created_at, updated_at</text>
  <text x="40" y="400" class="field">resolution_status, resolution_proposed_by, resolution_evidence</text>

  <!-- Photos -->
  <rect x="480" y="210" width="280" height="140" rx="6" class="tbl" />
  <text x="490" y="235" class="tbl-title">photos</text>
  <text x="490" y="260" class="field">id (UUID) PK</text>
  <text x="490" y="280" class="field">violation_id (UUID) FK → violations.id</text>
  <text x="490" y="300" class="field">url, storage_key, mime, size</text>
  <text x="490" y="320" class="field">created_at</text>

  <!-- Confirmations -->
  <rect x="480" y="370" width="360" height="120" rx="6" class="tbl" />
  <text x="490" y="395" class="tbl-title">confirmations</text>
  <text x="490" y="420" class="field">id (UUID) PK</text>
  <text x="490" y="440" class="field">violation_id (UUID) FK → violations.id</text>
  <text x="490" y="460" class="field">user_id (UUID) FK → users.id</text>
  <text x="490" y="480" class="field">created_at</text>

  <!-- Notifications -->
  <rect x="30" y="470" width="420" height="100" rx="6" class="tbl" />
  <text x="40" y="495" class="tbl-title">notifications</text>
  <text x="40" y="520" class="field">id (UUID) PK</text>
  <text x="40" y="540" class="field">user_id (UUID) FK → users.id</text>
  <text x="40" y="560" class="field">type, payload (JSON), read, created_at</text>

  <!-- Rules -->
  <rect x="480" y="520" width="520" height="160" rx="6" class="tbl" />
  <text x="490" y="545" class="tbl-title">violation_rules</text>
  <text x="490" y="570" class="field">id (UUID) PK</text>
  <text x="490" y="590" class="field">name, trigger_event, condition (JSONB)</text>
  <text x="490" y="610" class="field">threshold INT, weight_map JSONB, action, action_params JSONB</text>
  <text x="490" y="630" class="field">active BOOLEAN, created_at, updated_at</text>

  <!-- Audit Logs -->
  <rect x="30" y="600" width="420" height="140" rx="6" class="tbl" />
  <text x="40" y="625" class="tbl-title">audit_logs</text>
  <text x="40" y="650" class="field">id (UUID) PK</text>
  <text x="40" y="670" class="field">actor_id, action, target_type, target_id</text>
  <text x="40" y="690" class="field">meta (JSON), ip, user_agent, created_at</text>

  <!-- Relationships lines -->
  <line x1="190" y1="170" x2="190" y2="210" class="line" />
  <line x1="370" y1="120" x2="370" y2="210" class="line" />

  <line x1="210" y1="330" x2="480" y2="260" class="line" />
  <line x1="210" y1="360" x2="480" y2="380" class="line" />

  <line x1="540" y1="350" x2="540" y2="370" class="line" />
  <line x1="540" y1="390" x2="540" y2="420" class="line" />

  <line x1="160" y1="520" x2="160" y2="600" class="line" />

  <!-- Legend -->
  <rect x="820" y="40" width="340" height="120" rx="6" fill="#f7fff7" stroke="#cfe9cf" />
  <text x="840" y="70" class="note">Legend:</text>
  <text x="840" y="90" class="note">PK — primary key, FK — foreign key</text>
  <text x="840" y="110" class="note">JSONB — JSON blob (conditions, payloads)</text>
  <text x="840" y="130" class="note">Rules table drives confirm/resolve workflow</text>

</svg>

